<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="theme-color" content="#f8f5ec"><meta name="msapplication-navbutton-color" content="#f8f5ec"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec"><meta name="referrer" content="same-origin"><meta name="referrer" content="no-referrer"><meta name="description" content="Hadoop集群优化"><meta name="keywords" content="大数据,BigData,数据开发,Hadoop,Spark,Flink,Hive,HBase"><link rel="alternate" href="/cn/atom.xml" title="马攀的技术栈"><link rel="shortcut icon" type="image/x-icon" href="/cn/favicon.ico?v=2.11.0"><link rel="canonical" href="https://mapan.tech/cn/929b.html"><link rel="stylesheet" type="text/css" href="/cn/css/style.css?v=2.11.0"><script>window.config={toc:!0,fancybox:!1,pjax:!1,latex:!1}</script><title>Hadoop集群优化 - 马攀的技术栈</title></head><body><div id="mobile-navbar" class="mobile-navbar"><div class="mobile-header-logo"><a href="/cn/." class="logo">马攀的技术栈</a></div><div class="mobile-navbar-icon"><span></span> <span></span> <span></span></div></div><nav id="mobile-menu" class="mobile-menu slideout-menu"><ul class="mobile-menu-list"><a href="/cn/"><li class="mobile-menu-item">首页</li></a><a href="/cn/categories.html"><li class="mobile-menu-item">分类</li></a><a href="/cn/about.html"><li class="mobile-menu-item">关于</li></a><a href="/cn/message.html"><li class="mobile-menu-item">留言</li></a><a href="/cn/links.html"><li class="mobile-menu-item">友链</li></a></ul></nav><div class="container" id="mobile-panel"><header id="header" class="header"><div class="logo-wrapper"><a href="https://mapan.tech" class="logo">马攀的技术栈</a></div><nav class="site-navbar"><ul id="menu" class="menu"><li class="menu-item"><a class="menu-item-link" href="/cn/">首页</a></li><li class="menu-item"><a class="menu-item-link" href="/cn/categories.html">分类</a></li><li class="menu-item"><a class="menu-item-link" href="/cn/about.html">关于</a></li><li class="menu-item"><a class="menu-item-link" href="/cn/message.html">留言</a></li><li class="menu-item"><a class="menu-item-link" href="/cn/links.html">友链</a></li></ul></nav></header><main id="main" class="main"><div class="content-wrapper"><div id="content" class="content"><article class="post"><header class="post-header"><h1 class="post-title">Hadoop集群优化</h1><div class="post-meta"><span class="post-time">2017-12-26 </span><span class="post-category"><a href="/cn/categories/Hadoop/">Hadoop</a> </span><span id="/cn/929b.html" class="leancloud-visitors" data-flag-title="Hadoop集群优化">阅读数 <span class="leancloud-visitors-count">1000</span> </span><span class="post-count">字数统计 474 </span><span class="post-count">阅读时长 1</span></div></header><div class="post-toc" id="post-toc"><h2 class="post-toc-title">文章目录</h2><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#HDFS小文件的影响："><span class="toc-text">HDFS小文件的影响：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数据输入小文件处理："><span class="toc-text">数据输入小文件处理：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Map阶段"><span class="toc-text">Map阶段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reduce阶段"><span class="toc-text">Reduce阶段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IO传输"><span class="toc-text">IO传输</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#整体"><span class="toc-text">整体</span></a></li></ol></div></div><div class="post-content"><h2 id="HDFS小文件的影响："><a href="#HDFS小文件的影响：" class="headerlink" title="HDFS小文件的影响："></a>HDFS小文件的影响：</h2><ol><li>影响NameNode的寿命，文件的元数据存储在NameNode的内存当中</li><li>音响计算引擎的任务数量，比如每个小的文件都会生成一个Map任务</li></ol><h2 id="数据输入小文件处理："><a href="#数据输入小文件处理：" class="headerlink" title="数据输入小文件处理："></a>数据输入小文件处理：</h2><ol><li>合并小文件：对小文件进行归档（Har）、自定义Inputformat将小文件存储成SequenceFile文件。</li><li>采用ConbinFileInputFormat来作为输入，解决输入端大量小文件场景。</li><li>对于大量小文件Job，可以开启JVM重用。</li></ol><h2 id="Map阶段"><a href="#Map阶段" class="headerlink" title="Map阶段"></a>Map阶段</h2><ol><li>增大环形缓冲区大小。由100m扩大到200m</li><li>增大环形缓冲区溢写的比例。由80%扩大到90%</li><li>减少对溢写文件的merge次数。</li><li>不影响实际业务的前提下，采用Combiner提前合并，减少 I/O。</li></ol><h2 id="Reduce阶段"><a href="#Reduce阶段" class="headerlink" title="Reduce阶段"></a>Reduce阶段</h2><ol><li><p>合理设置Map和Reduce数：两个都不能设置太少，也不能设置太多。太少，会导致Task等待，延长处理时间；太多，会导致 Map、Reduce任务间竞争资源，造成处理超时等错误。</p></li><li><p>设置Map、Reduce共存：调整slowstart.completedmaps参数，使Map运行到一定程度后，Reduce也开始运行，减少Reduce的等待时间。</p></li><li>规避使用Reduce，因为Reduce在用于连接数据集的时候将会产生大量的网络消耗。</li><li>增加每个Reduce去Map中拿数据的并行数</li><li>集群性能可以的前提下，增大Reduce端存储数据内存的大小。</li></ol><h2 id="IO传输"><a href="#IO传输" class="headerlink" title="IO传输"></a>IO传输</h2><ol><li>采用数据压缩的方式，减少网络IO的的时间。安装Snappy和LZOP压缩编码器。</li><li>使用SequenceFile二进制文件</li></ol><h2 id="整体"><a href="#整体" class="headerlink" title="整体"></a>整体</h2><ol><li>MapTask默认内存大小为1G，可以增加MapTask内存大小为4-5g</li><li>ReduceTask默认内存大小为1G，可以增加ReduceTask内存大小为4-5g</li><li>可以增加MapTask的cpu核数，增加ReduceTask的CPU核数</li><li>增加每个Container的CPU核数和内存大小</li><li>调整每个Map Task和Reduce Task最大重试次数</li></ol></div><div class="post-copyright"><p class="copyright-item"><span>原文作者: </span><a href="https://mapan.tech/cn">MaPan</a></p><p class="copyright-item"><span>原文链接: </span><a href="https://mapan.tech/cn/929b.html">https://mapan.tech/cn/929b.html</a></p><p class="copyright-item"><span>许可协议: </span><a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a></p></div><footer class="post-footer"><nav class="post-nav"><a class="prev" href="/cn/3e9.html"><i class="iconfont icon-left"></i> <span class="prev-text nav-default">密码和方言</span> <span class="prev-text nav-mobile">上一篇</span> </a><a class="next" href="/cn/58c8.html"><span class="next-text nav-default">再谈电子DIY</span> <span class="prev-text nav-mobile">下一篇</span> <i class="iconfont icon-right"></i></a></nav></footer></article></div><div class="comments" id="comments"><div id="vcomments"></div></div></div></main><footer id="footer" class="footer"><div class="social-links"><a href="/cn/atom.xml" class="iconfont icon-rss" title="rss" target="_blank"></a></div><div class="copyright"><span class="division">&nbsp;</span><span class="post-count"> 全站字数 91.9k </span><span class="copyright-year">Since 2015 <span class="heart"><i class="iconfont icon-heart"></i> </span><span class="author">MaPan</span></span></div></footer><div class="back-to-top" id="back-to-top"><i class="iconfont icon-up"></i></div></div><script src="./lib/valine/av-min.js?v=3.0.4"></script><script src="./lib/valine/Valine.min.js"></script><script type="text/javascript">new Valine({el:"#vcomments",notify:!1,verify:!0,app_id:"XtxvAXPwOzM9noIc3eyxi3AS-gzGzoHsz",app_key:"yEVQszyxb4bwLuAGU5VHnPR8",placeholder:"说点什么吧...",avatar:"mm",visitor:"ture"})</script><script type="text/javascript" src="/cn/lib/jquery/jquery.min.js"></script><script type="text/javascript" src="/cn/lib/slideout/slideout.js"></script><script type="text/javascript" src="/cn/js/src/even.js?v=2.11.0"></script></body></html>